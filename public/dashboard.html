<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Analytics Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
  <div class="header-content">
    <h1>üìä Call Analytics Dashboard</h1>
    <div class="header-status">
      <div class="connection-status" id="connectionStatus">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Connecting...</span>
      </div>
      <div class="server-stats" id="serverStats">
        <span id="agentCount">0 agents</span>
        <span id="lastUpdated"></span>
      </div>
    </div>
    <div class="header-controls">
      <button class="settings-toggle" id="settingsToggle">‚öôÔ∏è Settings</button>
      <button class="debug-toggle" id="debugToggle">Debug</button>
    </div>
  </div>
</header>

    <!-- Debug Console -->
    <div class="debug-console" id="debugConsole">
        <div class="debug-header">
            <h3>Debug Console</h3>
            <button id="clearDebug">Clear</button>
        </div>
        <div class="debug-content" id="debugContent">
            Dashboard initializing...
        </div>
    </div>

    <!-- Settings Panel -->
<div class="settings-panel" id="settingsPanel">
  <div class="settings-header">
    <h3>‚öôÔ∏è Agent Reminder Settings</h3>
    <button id="closeSettings">‚úï</button>
  </div>
  <div class="settings-content">
    <div class="settings-controls">
      <button id="enableAllReminders" class="btn-success">Enable All</button>
      <button id="disableAllReminders" class="btn-warning">Disable All</button>
      <button id="saveAllSettings" class="btn-primary">üíæ Save All Changes</button>
    </div>
    <div class="settings-table-container">
      <table class="settings-table">
        <thead>
          <tr>
            <th>Agent Code</th>
            <th>Agent Name</th>
            <th>Status</th>
            <th>Interval (min)</th>
            <th>Enabled</th>
          </tr>
        </thead>
        <tbody id="settingsTableBody">
          <tr>
            <td colspan="5" class="loading">Loading settings...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

    <!-- Main Dashboard Grid -->
    <main class="dashboard-grid">
        <!-- Talk Time Card -->
        <div class="dashboard-card full-width" id="talkTimeCard">
            <div class="card-header">
                <h2>üìä Today's Talk Time</h2>
                <div class="card-controls">
                    <select id="sortSelect">
                        <option value="agentCode-asc">Agent Code ‚Üë</option>
                        <option value="agentCode-desc">Agent Code ‚Üì</option>
                        <option value="talkTime-asc">Talk Time ‚Üë</option>
                        <option value="talkTime-desc">Talk Time ‚Üì</option>
                    </select>
                </div>
            </div>
            <div class="card-content">
                <div class="table-container">
                    <table class="talk-time-table">
                        <thead>
                            <tr>
                                <th>Agent Code</th>
                                <th>Agent Name</th>
                                <th>Talk Time</th>
                                <th>Call Count</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="talkTimeTableBody">
                            <tr>
                                <td colspan="5" class="loading">Loading agents...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Phone Number Search Card -->
        <div class="dashboard-card full-width" id="searchCard">
            <div class="card-header">
                <h2>üîç Phone Number Search</h2>
            </div>
            <div class="card-content">
                <div class="search-container">
                    <input 
                        type="text" 
                        id="phoneSearchInput" 
                        placeholder="Enter 10-digit phone number..." 
                        maxlength="15"
                        class="search-input"
                    />
                    <button id="phoneSearchBtn" class="search-btn">üîç Search</button>
                    <button id="clearSearchBtn" class="clear-btn">Clear</button>
                </div>
                <div id="searchResults" class="search-results">
                    <div class="no-data">Enter a phone number to search call history</div>
                </div>
            </div>
        </div>

        <!-- Bottom Row: Two Columns -->
        <div class="dashboard-row">
            <!-- Currently On Call Card -->
            <div class="dashboard-card half-width" id="onCallCard">
                <div class="card-header">
                    <h2>üìû Currently On Call</h2>
                    <div class="card-badge" id="onCallCount">0</div>
                </div>
                <div class="card-content">
                    <div id="onCallList">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Idle Time Card -->
            <div class="dashboard-card half-width" id="idleTimeCard">
                <div class="card-header">
                    <h2>‚è∞ Time Since Last Call</h2>
                    <div class="card-badge" id="idleCount">0</div>
                </div>
                <div class="card-content">
                    <div id="idleTimeList">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Idle Sessions Analytics Section -->
<div class="idle-sessions-section mt-6">
  <div class="bg-white rounded-lg shadow-lg p-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">üìä Idle Sessions Analytics</h3>
    
    <!-- Filter Section -->
    <div class="filter-section bg-gray-50 p-4 rounded-lg mb-4">
      <div class="flex flex-wrap gap-4 items-end">
        <div class="flex-1 min-w-48">
          <label for="agentSelect" class="block text-sm font-medium text-gray-700 mb-1">Agent</label>
          <select id="agentSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">All Agents</option>
          </select>
        </div>
        
        <div class="flex-1 min-w-48">
          <label for="dateSelect" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
          <input type="date" id="dateSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        
        <div>
          <button id="applyFilters" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
            Apply Filters
          </button>
        </div>
        
        <div>
          <button id="clearFilters" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500">
            Clear
          </button>
        </div>
      </div>
    </div>
    
    <!-- Results Section -->
    <div id="idleSessionsResults">
      <!-- Loading State -->
      <div id="idleSessionsLoading" class="text-center py-8 hidden">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <p class="mt-2 text-gray-600">Loading idle sessions...</p>
      </div>
      
      <!-- Empty State -->
      <div id="idleSessionsEmpty" class="text-center py-8 hidden">
        <p class="text-gray-500">No idle sessions found for the selected criteria.</p>
      </div>
      
      <!-- Data Table -->
      <div id="idleSessionsTable" class="hidden">
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" data-sort="agent_code">
                  Agent Code <span class="sort-indicator">‚Üï</span>
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Agent Name
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" data-sort="start_time">
                  Start Time <span class="sort-indicator">‚Üï</span>
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  End Time
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" data-sort="idle_duration">
                  Duration <span class="sort-indicator">‚Üï</span>
                </th>
              </tr>
            </thead>
            <tbody id="idleSessionsTableBody" class="bg-white divide-y divide-gray-200">
              <!-- Table rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <!-- Pagination -->
        <div id="idleSessionsPagination" class="mt-4 flex items-center justify-between">
          <div class="text-sm text-gray-700">
            Showing <span id="recordsInfo">0</span> records
          </div>
          <div class="flex space-x-2">
            <button id="prevPage" class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50" disabled>
              ‚Üê Previous
            </button>
            <span id="pageInfo" class="px-3 py-1 text-gray-700">Page 1 of 1</span>
            <button id="nextPage" class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50" disabled>
              Next ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    </main>

    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="dashboard.js"></script>
</body>
</html>