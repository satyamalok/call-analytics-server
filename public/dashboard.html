<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Analytics Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
  <div class="header-content">
    <h1>📊 Call Analytics Dashboard</h1>
    <div class="header-status">
      <div class="connection-status" id="connectionStatus">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Connecting...</span>
      </div>
      <div class="server-stats" id="serverStats">
        <span id="agentCount">0 agents</span>
        <span id="lastUpdated"></span>
      </div>
    </div>
    <div class="header-controls">
      <button class="settings-toggle" id="settingsToggle">⚙️ Settings</button>
      <button class="debug-toggle" id="debugToggle">Debug</button>
    </div>
  </div>
</header>

    <!-- Debug Console -->
    <div class="debug-console" id="debugConsole">
        <div class="debug-header">
            <h3>Debug Console</h3>
            <button id="clearDebug">Clear</button>
        </div>
        <div class="debug-content" id="debugContent">
            Dashboard initializing...
        </div>
    </div>

    <!-- Settings Panel -->
<div class="settings-panel" id="settingsPanel">
  <div class="settings-content">
    <div class="settings-header">
      <h3>👥 Agent Management</h3>
      <button id="closeSettings" class="close-btn">✕</button>
    </div>
    
    <div class="settings-controls">
      <button id="addAgentBtn" class="btn-success">➕ Add Agent</button>
      <button id="refreshAgentsBtn" class="btn-secondary">🔄 Refresh</button>
    </div>
    
    <!-- Add Agent Form -->
    <div class="add-agent-form hidden" id="addAgentForm">
      <div class="form-header">
        <h4>Add New Agent</h4>
      </div>
      <div class="form-group">
        <label for="newAgentCode">Agent Code</label>
        <input type="text" id="newAgentCode" placeholder="e.g., AGT001" required maxlength="20">
        <small>Unique identifier for the agent</small>
      </div>
      <div class="form-group">
        <label for="newAgentName">Agent Name</label>
        <input type="text" id="newAgentName" placeholder="e.g., John Doe" required maxlength="100">
        <small>Full name of the agent</small>
      </div>
      <div class="form-buttons">
        <button id="saveNewAgent" class="btn-success">💾 Add Agent</button>
        <button id="cancelNewAgent" class="btn-secondary">Cancel</button>
      </div>
    </div>
    
    <!-- Agents Table -->
    <div class="agents-table-container">
      <div id="agentsTableEmpty" class="table-empty-state">
        <div class="empty-icon">👤</div>
        <h4>No Agents Configured</h4>
        <p>Add agents to start tracking their performance and call analytics.</p>
        <button class="btn-success" onclick="document.getElementById('addAgentBtn').click()">➕ Add First Agent</button>
      </div>
      
      <table id="agentsTable" class="agents-table hidden">
        <thead>
          <tr>
            <th>Agent Code</th>
            <th>Agent Name</th>
            <th>Added</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="agentsTableBody">
          <!-- Dynamic content -->
        </tbody>
      </table>
    </div>
    
    <div class="settings-footer">
      <small>💡 Tip: Agent codes are used by the mobile app to identify agents during calls.</small>
    </div>
  </div>
</div>

    <!-- Main Dashboard Grid -->
    <main class="dashboard-grid">
        <!-- Talk Time Card -->
        <div class="dashboard-card full-width" id="talkTimeCard">
            <div class="card-header">
                <h2>📊 Today's Talk Time</h2>
                <div class="card-controls">
                    <select id="sortSelect">
                        <option value="agentCode-asc">Agent Code ↑</option>
                        <option value="agentCode-desc">Agent Code ↓</option>
                        <option value="talkTime-asc">Talk Time ↑</option>
                        <option value="talkTime-desc">Talk Time ↓</option>
                    </select>
                </div>
            </div>
            <div class="card-content">
                <div class="table-container">
                    <table class="talk-time-table">
                        <thead>
                            <tr>
                                <th>Agent Code</th>
                                <th>Agent Name</th>
                                <th>Talk Time</th>
                                <th>Call Count</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="talkTimeTableBody">
                            <tr>
                                <td colspan="5" class="loading">Loading agents...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Phone Number Search Card -->
        <div class="dashboard-card full-width" id="searchCard">
            <div class="card-header">
                <h2>🔍 Phone Number Search</h2>
            </div>
            <div class="card-content">
                <div class="search-container">
                    <input 
                        type="text" 
                        id="phoneSearchInput" 
                        placeholder="Enter 10-digit phone number..." 
                        maxlength="15"
                        class="search-input"
                    />
                    <button id="phoneSearchBtn" class="search-btn">🔍 Search</button>
                    <button id="clearSearchBtn" class="clear-btn">Clear</button>
                </div>
                <div id="searchResults" class="search-results">
                    <div class="no-data">Enter a phone number to search call history</div>
                </div>
            </div>
        </div>

        <!-- Bottom Row: Two Columns -->
        <div class="dashboard-row">
            <!-- Currently On Call Card -->
            <div class="dashboard-card half-width" id="onCallCard">
                <div class="card-header">
                    <h2>📞 Currently On Call</h2>
                    <div class="card-badge" id="onCallCount">0</div>
                </div>
                <div class="card-content">
                    <div id="onCallList">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Idle Time Card -->
            <div class="dashboard-card half-width" id="idleTimeCard">
                <div class="card-header">
                    <h2>⏰ Time Since Last Call</h2>
                    <div class="card-badge" id="idleCount">0</div>
                </div>
                <div class="card-content">
                    <div id="idleTimeList">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Idle Sessions Analytics Section -->
<div class="dashboard-grid">
  <div class="idle-sessions-section">
    <div class="dashboard-card">
      <div class="card-header">
        <h2>📊 Idle Sessions Analytics</h2>
        <div class="card-badge" id="idleSessionsCount">0 sessions</div>
      </div>
      <div class="card-content">
        <!-- Filter Section -->
        <div class="filter-section">
          <div class="flex">
            <div class="flex-1">
              <label for="agentSelect">Agent</label>
              <select id="agentSelect">
                <option value="">All Agents</option>
              </select>
            </div>
            
            <div class="flex-1">
              <label for="dateSelect">Date</label>
              <input type="date" id="dateSelect">
            </div>
            
            <div>
              <button id="applyFilters" class="filter-btn">
                Apply Filters
              </button>
            </div>
            
            <div>
              <button id="clearFilters" class="filter-btn secondary">
                Clear
              </button>
            </div>
          </div>
        </div>
        
        <!-- Results Section -->
        <div id="idleSessionsResults">
          <!-- Loading State -->
          <div id="idleSessionsLoading" class="idle-sessions-loading hidden">
            <div class="spinner"></div>
            <p>Loading idle sessions...</p>
          </div>
          
          <!-- Empty State -->
          <div id="idleSessionsEmpty" class="idle-sessions-empty hidden">
            <p>No idle sessions found for the selected criteria.</p>
          </div>
          
          <!-- Data Table -->
          <div id="idleSessionsTable" class="hidden">
            <div class="table-container">
              <table class="idle-sessions-table">
                <thead>
                  <tr>
                    <th data-sort="agent_code">
                      Agent Code <span class="sort-indicator">↕</span>
                    </th>
                    <th>Agent Name</th>
                    <th data-sort="start_time">
                      Start Time <span class="sort-indicator">↕</span>
                    </th>
                    <th>End Time</th>
                    <th data-sort="idle_duration">
                      Duration <span class="sort-indicator">↕</span>
                    </th>
                  </tr>
                </thead>
                <tbody id="idleSessionsTableBody">
                  <!-- Table rows will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
            
            <!-- Pagination -->
            <div id="idleSessionsPagination" class="idle-sessions-pagination">
              <div class="pagination-info">
                Showing <span id="recordsInfo">0</span> records
              </div>
              <div class="pagination-controls">
                <button id="prevPage" class="pagination-btn" disabled>
                  ← Previous
                </button>
                <span id="pageInfo" class="page-info">Page 1 of 1</span>
                <button id="nextPage" class="pagination-btn" disabled>
                  Next →
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Agent Performance Dashboard Section -->
  <div class="agent-performance-section">
    <div class="dashboard-card">
      <div class="card-header">
        <h2>📈 Agent Performance Dashboard</h2>
        <div class="card-badge" id="performanceCount">Select agent & date</div>
      </div>
      <div class="card-content">
        <!-- Agent Performance Filters -->
        <div class="filter-section">
          <div class="flex">
            <div class="flex-1">
              <label for="performanceAgentSelect">Agent</label>
              <select id="performanceAgentSelect" required>
                <option value="">Select Agent</option>
              </select>
            </div>
            
            <div class="flex-1">
              <label for="performanceDateMode">Date Mode</label>
              <select id="performanceDateMode">
                <option value="single">Single Date</option>
                <option value="range">Date Range</option>
              </select>
            </div>
            
            <div class="flex-1" id="singleDateContainer">
              <label for="performanceDate">Date</label>
              <input type="date" id="performanceDate">
            </div>
            
            <div class="flex-1 hidden" id="startDateContainer">
              <label for="performanceStartDate">Start Date</label>
              <input type="date" id="performanceStartDate">
            </div>
            
            <div class="flex-1 hidden" id="endDateContainer">
              <label for="performanceEndDate">End Date</label>
              <input type="date" id="performanceEndDate">
            </div>
            
            <div>
              <button id="loadPerformanceData" class="filter-btn">
                Load Data
              </button>
            </div>
          </div>
        </div>
        
        <!-- Performance Results -->
        <div id="performanceResults">
          <!-- Loading State -->
          <div id="performanceLoading" class="idle-sessions-loading hidden">
            <div class="spinner"></div>
            <p>Loading performance data...</p>
          </div>
          
          <!-- Empty State -->
          <div id="performanceEmpty" class="idle-sessions-empty">
            <p>Select an agent and date to view performance data.</p>
          </div>
          
          <!-- Performance Data List -->
          <div id="performanceData" class="hidden">
            <div class="performance-summary" id="performanceSummary"></div>
            <div class="performance-list" id="performanceList"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    </main>

  

    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="dashboard.js"></script>
</body>
</html>