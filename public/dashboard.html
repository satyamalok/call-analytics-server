<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Analytics Dashboard</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <h1>üìä Call Analytics Dashboard</h1>
            <div class="header-status">
                <div class="connection-status" id="connectionStatus">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <div class="server-stats" id="serverStats">
                    <span id="agentCount">0 agents</span>
                    <span id="lastUpdated"></span>
                </div>
            </div>
            <button class="debug-toggle" id="debugToggle">Debug</button>
        </div>
    </header>

    <!-- Debug Console -->
    <div class="debug-console" id="debugConsole">
        <div class="debug-header">
            <h3>Debug Console</h3>
            <button id="clearDebug">Clear</button>
        </div>
        <div class="debug-content" id="debugContent">
            Dashboard initializing...
        </div>
    </div>

    <!-- Main Dashboard Grid -->
    <main class="dashboard-grid">
        <!-- Talk Time Card -->
        <div class="dashboard-card" id="talkTimeCard">
            <div class="card-header">
                <h2>üìä Today's Talk Time</h2>
                <div class="card-controls">
                    <select id="sortSelect">
                        <option value="agentCode-asc">Agent Code ‚Üë</option>
                        <option value="agentCode-desc">Agent Code ‚Üì</option>
                        <option value="talkTime-asc">Talk Time ‚Üë</option>
                        <option value="talkTime-desc">Talk Time ‚Üì</option>
                    </select>
                </div>
            </div>
            <div class="card-content">
                <div class="table-container">
                    <table class="talk-time-table">
                        <thead>
                            <tr>
                                <th>Agent Code</th>
                                <th>Agent Name</th>
                                <th>Talk Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="talkTimeTableBody">
                            <tr>
                                <td colspan="4" class="loading">Loading agents...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Currently On Call Card -->
        <div class="dashboard-card" id="onCallCard">
            <div class="card-header">
                <h2>üìû Currently On Call</h2>
                <div class="card-badge" id="onCallCount">0</div>
            </div>
            <div class="card-content">
                <div id="onCallList">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Idle Time Card -->
        <div class="dashboard-card" id="idleTimeCard">
            <div class="card-header">
                <h2>‚è∞ Time Since Last Call</h2>
                <div class="card-badge" id="idleCount">0</div>
            </div>
            <div class="card-content">
                <div id="idleTimeList">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Server Stats Card -->
        <div class="dashboard-card" id="statsCard">
            <div class="card-header">
                <h2>üìà Server Statistics</h2>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalAgents">0</div>
                        <div class="stat-label">Total Agents</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="onlineAgents">0</div>
                        <div class="stat-label">Online Now</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="todayCalls">0</div>
                        <div class="stat-label">Today's Calls</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeCalls">0</div>
                        <div class="stat-label">Active Calls</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Load scripts in correct order -->
    <script src="js/utils/helpers.js"></script>
    <script>
        // Wait for Helpers to be available before loading other scripts
        if (!window.Helpers) {
            console.error('Helpers not loaded');
        }
    </script>
    <script src="js/utils/formatters.js"></script>
    <script src="js/services/NotificationService.js"></script>
    <script src="js/services/APIService.js"></script>
    <script src="js/services/WebSocketService.js"></script>
    <script>
        // Verify WebSocketService is properly initialized
        console.log('WebSocketService methods available:', !!window.WebSocketService.on);
        if (!window.WebSocketService.on) {
            console.error('WebSocketService.on method not available');
            // Reload the page once to try again
            if (!sessionStorage.getItem('wsReloaded')) {
                sessionStorage.setItem('wsReloaded', 'true');
                window.location.reload();
            }
        }
    </script>
    <script src="js/components/BaseComponent.js"></script>
    <script src="js/components/TalkTimeCard.js"></script>
    <script src="js/components/OnCallCard.js"></script>
    <script src="js/components/IdleTimeCard.js"></script>
    <script src="js/components/StatsCard.js"></script>
    <script src="js/main.js"></script>
</body>
</html>